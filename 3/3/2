<p>В большинстве дистрибутивов программа <code>make</code> отсутствует. Поставьте её. Из-за особенности её названия, более разумным будет использовать <code>GNU make</code> как ключевую строку.</p>

<p>Начнём с простого make-файла. Для наглядности будем компилировать модули <code>foo</code> и <code>boo</code> с статическую библиотеку.</p>

<p><code>Makefile</code></p>

<pre><code class="language-makefile">lib:
	gcc foo.c -c
	gcc boo.c -c
	ar -rc libfboo.a foo.o boo.o

program:
	gcc foo.c -c
	gcc boo.c -c
	ar -rc libfboo.a foo.o boo.o
	gcc main.c -L. -lfboo</code></pre>

<p>Здесь определены два рецепта: <code>lib</code> и <code>program</code>. Чтобы выполнить их, необходимо ввести <code>make lib</code> или <code>make program</code> соответственно. Первый рецепт собирает только библиотеку (пусть, например, пользователю может пригодиться только она), а второй и библиотеку, и саму программу.</p>

<p>Важно: в make-файлах требуется использовать символы табуляции, вместо пробелов. Добавьте соответствующую настройку в ваш text editor, если требуется (VS Code, например, сам ставит табуляции в make-файлах).</p>

<p>Содержимое рецептов — это почти обычные <code>shell</code> команды. Однако они запускаются не в одной <code>shell</code>-сессии, а в разных, что иногда важно.</p>

<p>Мы можем упростить наш make-файл: рецепт сборки программы включает в себя содержимое рецепта сборки библиотеки. Мы можем в требование одного рецепта вписать название другого рецепта.</p>

<pre><code class="language-makefile">lib:
	gcc foo.c -c
	gcc boo.c -c
	ar -rc libfboo.a foo.o boo.o

program: lib
	gcc main.c -L. -lfboo</code></pre>

<p>В этом случае, перед выполнением рецепта <code>program</code> будет выполнен рецепт <code>lib</code>. Важно отметить, что рецепт <code>lib</code> будет выполнен в любом случае и полностью, а значит, экономии ресурсов мы пока не добились.</p>

<p>Добавим рецепт на удаление временных файлов:</p>

<pre><code class="language-makefile">...
clean:
	rm libfboo.a foo.o boo.o main.o a.out</code></pre>

<p>Его не следует добавлять в зависимости другим рецептам, так как удаление всех файлов сделает необходимой полную перекомпиляцию.</p>

<p>Обратите внимание, что <code>make</code> является ленивым языком. (Можете теперь рассказывать программистам на <code>haskell</code>-е, что тоже в некотором смысле пишете на ленивом языке.)</p>